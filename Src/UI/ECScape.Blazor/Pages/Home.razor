@page "/"
@inject GameEngineHost GameHost
@inject InputSystem InputSystem

<PageTitle>Home</PageTitle>

<h3>ECScape Web</h3>

<div @onkeydown="HandleKeyDown"
     @onkeyup="HandleKeyUp"
     tabindex="0"
     style="outline: none;">
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
    </div>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await GameHost.InitializeAsync("gameCanvas");
            await GameHost.StartAsync();
        }
    }

    private void HandleKeyDown(KeyboardEventArgs e)
    {
        switch (e.Key)
        {
            case "ArrowLeft":
                InputSystem.SetLeft(true);
                break;
            case "ArrowRight":
                InputSystem.SetRight(true);
                break;
            case "ArrowUp":
                InputSystem.SetJump(true);
                break;
        }
    }

    private void HandleKeyUp(KeyboardEventArgs e)
    {
        switch (e.Key)
        {
            case "ArrowLeft":
                InputSystem.SetLeft(false);
                break;
            case "ArrowRight":
                InputSystem.SetRight(false);
                break;
            case "ArrowUp":
                InputSystem.SetJump(false);
                break;
        }
    }

    public async ValueTask DisposeAsync()
    {
        await GameHost.DisposeAsync();
    }
}